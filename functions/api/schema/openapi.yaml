openapi: '3.1.0'
info:
  title: OpenPecha API v2
  version: '2.1.0'
servers:
  - url: http://127.0.0.1:5001/pecha-backend-dev/us-central1/api
    description: Local Development
  - url: https://api-l25bgmwqoa-uc.a.run.app
    description: Development
  - url: https://api-aq25662yyq-uc.a.run.app
    description: Production

paths:
  /v2/instances/{instance_id}:
    get:
      summary: Retrieve instance by instance ID
      description: Fetch instance content for a given instance ID with optional alignment
      tags:
        - Instances
      parameters:
        - name: instance_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the instance to retrieve
        - name: aligned
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Whether to include aligned source text
      responses:
        "200":
          description: Instance retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  target:
                    type: object
                    properties:
                      pecha:
                        type: object
                      annotations:
                        type: array
                        items:
                          type: object
                  source:
                    type: object
                    properties:
                      pecha:
                        type: object
                      annotations:
                        type: array
                        items:
                          type: object
              examples:
                success:
                  summary: Text with alignment
                  value:
                    target:
                      pecha:
                        id: "I12345678"
                        base_text: "This is the target text content"
                      annotations:
                        - id: "A12345678"
                          type: "segmentation"
                    source:
                      pecha:
                        id: "I87654321"
                        base_text: "This is the source text content"
                      annotations:
                        - id: "A87654321"
                          type: "alignment"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/instances/{instance_id}/related:
    get:
      summary: Find related texts
      description: Find all related texts, instances and their aligned segments for a given character span in an instance
      tags:
        - Instances
      parameters:
        - name: instance_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the instance to find related texts for
        - name: span_start
          in: query
          required: true
          schema:
            type: integer
            minimum: 0
          description: Start character position of the span
        - name: span_end
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
          description: End character position of the span (exclusive, must be greater than start)
      responses:
        "200":
          description: Related texts retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  targets:
                    type: array
                    description: Texts that the selected segments point to
                    items:
                      type: object
                      properties:
                        instance:
                          type: object
                          description: Manifestation details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [diplomatic, critical, collated]
                            copyright:
                              type: string
                              enum: [public, copyrighted]
                            bdrc:
                              type: string
                            wiki:
                              type: string
                            colophon:
                              type: string
                            incipit_title:
                              type: object
                              additionalProperties:
                                type: string
                            alt_incipit_titles:
                              type: array
                              items:
                                type: object
                                additionalProperties:
                                  type: string
                            annotations:
                              type: array
                              items:
                                type: object
                        text:
                          type: object
                          description: Expression (text) details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [root, commentary, translation]
                            title:
                              type: object
                              additionalProperties:
                                type: string
                            language:
                              type: string
                              enum: [en, bo, zh, sa]
                            contributions:
                              type: array
                              items:
                                type: object
                            date:
                              type: string
                            bdrc:
                              type: string
                            wiki:
                              type: string
                            parent:
                              type: string
                        spans:
                          type: array
                          description: Merged character spans from aligned segments
                          items:
                            type: object
                            properties:
                              start:
                                type: integer
                              end:
                                type: integer
                  sources:
                    type: array
                    description: Texts whose segments point to the selected segments
                    items:
                      type: object
                      properties:
                        instance:
                          type: object
                          description: Manifestation details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [diplomatic, critical, collated]
                            copyright:
                              type: string
                              enum: [public, copyrighted]
                            bdrc:
                              type: string
                            wiki:
                              type: string
                            colophon:
                              type: string
                            incipit_title:
                              type: object
                              additionalProperties:
                                type: string
                            alt_incipit_titles:
                              type: array
                              items:
                                type: object
                                additionalProperties:
                                  type: string
                            annotations:
                              type: array
                              items:
                                type: object
                        text:
                          type: object
                          description: Expression (text) details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [root, commentary, translation]
                            title:
                              type: object
                              additionalProperties:
                                type: string
                            language:
                              type: string
                              enum: [en, bo, zh, sa]
                            contributions:
                              type: array
                              items:
                                type: object
                            date:
                              type: string
                            bdrc:
                              type: string
                            wiki:
                              type: string
                            parent:
                              type: string
                        spans:
                          type: array
                          description: Merged character spans from aligned segments
                          items:
                            type: object
                            properties:
                              start:
                                type: integer
                              end:
                                type: integer
              examples:
                success:
                  summary: Related texts with merged spans separated by direction
                  value:
                    targets:
                      - instance:
                          id: "I87654321"
                          type: "diplomatic"
                          copyright: "public"
                          bdrc: "W789012"
                        text:
                          id: "T87654321"
                          type: "translation"
                          title:
                            en: "English Translation"
                          language: "en"
                          parent: "T12345678"
                        spans:
                          - start: 0
                            end: 150
                          - start: 200
                            end: 350
                    sources:
                      - instance:
                          id: "I11111111"
                          type: "critical"
                          copyright: "public"
                        text:
                          id: "T11111111"
                          type: "root"
                          title:
                            bo: "མ་ཕྱི།"
                          language: "bo"
                        spans:
                          - start: 50
                            end: 100
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              examples:
                missing_params:
                  summary: Missing parameters
                  value:
                    error: "Both 'start' and 'end' query parameters are required"
                invalid_integers:
                  summary: Invalid parameter types
                  value:
                    error: "'start' and 'end' must be valid integers"
                invalid_span:
                  summary: Invalid span range
                  value:
                    error: "Invalid span: 'start' must be >= 0, 'end' must be > start"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              examples:
                no_segments:
                  summary: No segments found
                  value:
                    error: "No segments found containing span [0, 100) in instance 'I12345678'"
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/instances/{instance_id}/excerpt:
    get:
      summary: Get text excerpt
      description: Retrieve a specific excerpt (substring) of the base text content for a given instance based on character span
      tags:
        - Instances
      parameters:
        - name: instance_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the instance to retrieve excerpt from
        - name: span_start
          in: query
          required: true
          schema:
            type: integer
            minimum: 0
          description: Start character position of the excerpt (inclusive)
        - name: span_end
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
          description: End character position of the excerpt (exclusive, must be greater than span_start)
      responses:
        "200":
          description: Excerpt retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  excerpt:
                    type: string
                    description: The extracted text content from the specified character span
              examples:
                success:
                  summary: Excerpt from position 2 to 4
                  value:
                    excerpt: "hj"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              examples:
                missing_params:
                  summary: Missing required parameters
                  value:
                    error: "Both 'span_start' and 'span_end' query parameters are required"
                invalid_span:
                  summary: Invalid span range
                  value:
                    error: "Invalid span: 'span_start' must be >= 0, 'span_end' must be > span_start"
                span_exceeds:
                  summary: Span exceeds text length
                  value:
                    error: "span_end (1000) exceeds base text length (500)"
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/texts/{text_id}/instances:
    get:
      summary: Get instances for text
      description: Retrieve all instances associated with a text
      tags:
        - Instances
      parameters:
        - name: text_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the text
      responses:
        "200":
          description: Instances retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    type:
                      type: string
                      enum: [diplomatic, critical, collated]
                    copyright:
                      type: string
                      enum: [public, copyrighted]
                    annotations:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: string
                          type:
                            type: string
                            enum: [segmentation, alignment, version]
                          aligned_to:
                            type: string
                    bdrc:
                      type: string
                    wiki:
                      type: string
                    colophon:
                      type: string
                    incipit_title:
                      type: object
                      additionalProperties:
                        type: string
                    alt_incipit_titles:
                      type: array
                      items:
                        type: object
                        additionalProperties:
                          type: string
                    alignment_sources:
                      type: array
                      items:
                        type: string
                      description: List of manifestation IDs that have annotations aligned to this manifestation
                    alignment_targets:
                      type: array
                      items:
                        type: string
                      description: List of manifestation IDs that this manifestation's annotations are aligned to

              examples:
                success:
                  summary: List of instances
                  value:
                    - alt_incipit_titles: []
                      bdrc: "W123456"
                      colophon: "Sample colophon text"
                      copyright: "public"
                      incipit_title:
                        bo: "དབུ་ཚིག"
                        en: "Opening words"
                      type: "diplomatic"
                      wiki: null
                    - alt_incipit_titles: []
                      bdrc: "W123456"
                      colophon: "Sample colophon text"
                      copyright: "public"
                      incipit_title:
                        bo: "དབུ་ཚིག"
                        en: "Opening words"
                      type: "diplomatic"
                      wiki: null
                    - alt_incipit_titles: []
                      bdrc: "W123456"
                      colophon: "Sample colophon text"
                      copyright: "public"
                      incipit_title:
                        bo: "དབུ་ཚིག"
                        en: "Opening words"
                      type: "diplomatic"
                      wiki: null
                    - alt_incipit_titles: []
                      bdrc: "W123456"
                      colophon: "Sample colophon text"
                      copyright: "public"
                      incipit_title:
                        bo: "དབུ་ཚིག"
                        en: "Opening words"
                      type: "diplomatic"
                      wiki: null
                    - alt_incipit_titles: []
                      bdrc: "W123456"
                      colophon: "Sample colophon text"
                      copyright: "public"
                      incipit_title:
                        bo: "དབུ་ཚིག"
                        en: "Opening words"
                      type: "critical"
                      wiki: null
                    - alt_incipit_titles: []
                      bdrc: "W123456"
                      colophon: "Sample colophon text"
                      copyright: "public"
                      incipit_title: null
                      type: "diplomatic"
                      wiki: null
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/ServerError'

    post:
      summary: Create a new instance
      description: Create a new instance with metadata for a specific text
      tags:
        - Instances
      parameters:
        - name: text_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the text to create an instance for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - metadata
                - content
              properties:
                metadata:
                  type: object
                  required:
                    - type
                  properties:
                    type:
                      type: string
                      enum: [diplomatic, critical, collated]
                      description: Type of manifestation
                    copyright:
                      type: string
                      enum: [public, copyrighted]
                      default: public
                      description: Copyright status
                    bdrc:
                      type: string
                      description: BDRC identifier (required for diplomatic type)
                    wiki:
                      type: string
                      description: Wiki identifier
                    colophon:
                      type: string
                      description: Colophon text
                    incipit_title:
                      type: object
                      additionalProperties:
                        type: string
                      description: Localized incipit title
                    alt_incipit_titles:
                      type: array
                      items:
                        type: object
                        additionalProperties:
                          type: string
                      description: Alternative localized incipit titles
                annotation:
                  type: array
                  items:
                    type: object
                  description: Annotation data
                content:
                  type: string
                  description: The text content
            examples:
              valid_diplomatic_instance_with_annotation:
                summary: Valid diplomatic instance creation with annotation
                value:
                  metadata:
                    type: "diplomatic"
                    copyright: "public"
                    bdrc: "W123456"
                    colophon: "Sample colophon text"
                    incipit_title:
                      en: "Opening words"
                      bo: "དབུ་ཚིག"
                  annotation:
                    - span:
                        start: 0
                        end: 20
                    - reference: "https://example.com/image1.png"
                  content: "This is the text content to be stored"     
              valid_critical_instance_with_annotation:
                summary: Valid critical instance creation with annotation
                value:
                  metadata:
                    type: "critical"
                    copyright: "public"
                    colophon: "Sample colophon text"
                    incipit_title:
                      en: "Opening words"
                      bo: "དབུ་ཚིག"
                  annotation:
                    - span:
                        start: 0
                        end: 20
                  content: "This is the text content to be stored"           
              valid_critical_instance_without_annotation:
                summary: Valid critical instance creation without annotation
                value:
                  metadata:
                    type: "critical"
                    copyright: "public"
                    colophon: "Sample colophon text"
                    incipit_title:
                      en: "Opening words"
                      bo: "དབུ་ཚིག"
                  content: "This is the text content to be stored"          
              valid_diplomatic_instance_without_annotation:
                summary: Valid diplomatic instance creation without annotation
                value:
                  metadata:
                    type: "diplomatic"
                    copyright: "public"
                    bdrc: "W123456"
                    colophon: "Sample colophon text"
                    incipit_title:
                      en: "Opening words"
                      bo: "དབུ་ཚིག"
                  content: "This is the text content to be stored"                           
      responses:
        "201":
          description: Instance created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Instance created successfully"
                  id:
                    type: string
                    examples:
                      - "ABC12345678"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "422":
          $ref: '#/components/responses/ValidationError'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/instances/{instance_id}/translation:
    post:
      summary: Create a translation
      description: Create a translation of an existing instance
      tags:
        - Instances
      parameters:
        - name: instance_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the original instance to translate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - language
                - content
                - title
                - annotation
              properties:
                language:
                  type: string
                  enum: [en, bo, zh, sa]
                  description: Target language code
                content:
                  type: string
                  description: The translated text content
                title:
                  type: string
                  description: Title of the translation
                alt_titles:
                  type: array
                  items:
                    type: string
                author:
                  type: object
                  properties:
                    person_id:
                      type: string
                    person_bdrc_id:
                      type: string
                    ai_id:
                      type: string
                  description: Creator of the translation (optional)
                annotation:
                  type: array
                  items:
                    type: object
                  description: Segmentation annotation for translation (required)
                alignment_annotation:
                  type: array
                  items:
                    type: object
                  description: Alignment annotation for translation (optional, must be provided together with target_annotation)
                target_annotation:
                  type: array
                  items:
                    type: object
                  description: Alignment annotation for original text (optional, must be provided together with alignment_annotation)
                copyright:
                  type: string
                  enum: [public, copyrighted]
                  default: public
            examples:
              valid_translation:
                summary: Valid translation creation request
                value:
                  language: "en"
                  content: "This is the translated text content"
                  title: "Translated Title"
                  author:
                    person_id: "P12345678"
                  annotation:
                    - span:
                        start: 0
                        end: 35
                      index: 0
                  alignment_annotation:
                    - span:
                        start: 0
                        end: 20
                      index: 0
                      alignment_index: [0]
                  copyright: "public"
      responses:
        "201":
          description: Translation created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Text created successfully"
                  instance_id:
                    type: string
                    examples:
                      - "ABC12345678"
                  text_id:
                    type: string
                    examples:
                      - "ABC12345678"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "422":
          $ref: '#/components/responses/ValidationError'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/instances/{instance_id}/commentary:
    post:
      summary: Create a commentary
      description: Create a commentary of an existing instance
      tags:
        - Instances
      parameters:
        - name: instance_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the original instance to comment on
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - language
                - content
                - title
                - annotation
              properties:
                language:
                  type: string
                  enum: [en, bo, zh, sa]
                  description: Language code for the commentary
                content:
                  type: string
                  description: The commentary text content
                title:
                  type: string
                  description: Title of the commentary
                alt_titles:
                  type: array
                  items:
                    type: string
                author:
                  type: object
                  properties:
                    person_id:
                      type: string
                    person_bdrc_id:
                      type: string
                annotation:
                  type: array
                  items:
                    type: object
                  description: Segmentation annotation for commentary (required)
                alignment_annotation:
                  type: array
                  items:
                    type: object
                  description: Alignment annotation for commentary (optional, must be provided together with target_annotation)
                target_annotation:
                  type: array
                  items:
                    type: object
                  description: Alignment annotation for original text (optional, must be provided together with alignment_annotation)
                copyright:
                  type: string
                  enum: [public, copyrighted]
                  default: public
            examples:
              valid_commentary:
                summary: Valid commentary creation request
                value:
                  language: "bo"
                  content: "This is the commentary text content explaining the original"
                  title: "Commentary on Original Text"
                  author:
                    person_id: "P12345678"
                  annotation:
                    - span:
                        start: 0
                        end: 50
                      index: 0
                  alignment_annotation:
                    - span:
                        start: 0
                        end: 20
                      index: 0
                      alignment_index: [0]
                  copyright: "public"
      responses:
        "201":
          description: Commentary created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Text created successfully"
                  instance_id:
                    type: string
                    examples:
                      - "ABC12345678"
                  text_id:
                    type: string
                    examples:
                      - "ABC12345678"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "422":
          $ref: '#/components/responses/ValidationError'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/texts:
    get:
      summary: Retrieve all texts
      description: Fetch all texts with optional filtering and pagination
      tags:
        - Texts
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of results per page
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of results to skip
        - name: type
          in: query
          required: false
          schema:
            type: string
            enum: [root, commentary, translation]
          description: Filter by text type
        - name: language
          in: query
          required: false
          schema:
            type: string
          description: Filter by language code
        - name: author
          in: query
          required: false
          schema:
            type: string
          description: Filter by author name
      responses:
        "200":
          description: Texts retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    type:
                      type: string
                      enum: [root, commentary, translation]
                    title:
                      type: object
                      additionalProperties:
                        type: string
                    alt_titles:
                      type: array
                      items:
                        type: object
                        additionalProperties:
                          type: string
                    language:
                      type: string
                      enum: [en, bo, zh, sa]
                    contributions:
                      type: array
                      items:
                        type: object
                        properties:
                          person_id:
                            type: string
                          person_bdrc_id:
                            type: string
                          ai_id:
                            type: string
                          role:
                            type: string
                            enum: [author, translator, reviser, scholar]
                    date:
                      type: string
                    bdrc:
                      type: string
                    wiki:
                      type: string
                    parent:
                      type: string
              examples:
                success:
                  summary: List of texts
                  value:
                    - id: "ABC12345678"
                      type: "root"
                      title:
                        en: "Sample Expression"
                        bo: "དཔེ་མཚོན་ཚིག་སྒྲུབ།"
                      language: "bo"
                      contributions:
                        - person_id: "P12345678"
                          role: "author"
                      date: "2024-01-01"
                      bdrc: "W123456"
                    - id: "DEF87654321"
                      type: "translation"
                      title:
                        en: "AI Generated Translation"
                      language: "en"
                      contributions:
                        - ai_id: "gpt-4"
                          role: "translator"
                      parent: "ABC12345678"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "500":
          $ref: '#/components/responses/ServerError'

    post:
      summary: Create text
      description: Create a new text record
      tags:
        - Texts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - title
                - language
                - contributions
              properties:
                type:
                  type: string
                  enum: [root, commentary, translation]
                title:
                  type: object
                  additionalProperties:
                    type: string
                  description: Localized title
                alt_titles:
                  type: array
                  items:
                    type: object
                    additionalProperties:
                      type: string
                  description: Alternative localized titles
                language:
                  type: string
                  enum: [en, bo, zh, sa]
                contributions:
                  type: array
                  items:
                    type: object
                    properties:
                      person_id:
                        type: string
                      person_bdrc_id:
                        type: string
                      ai_id:
                        type: string
                      role:
                        type: string
                        enum: [author, translator, reviser, scholar]
                date:
                  type: string
                bdrc:
                  type: string
                wiki:
                  type: string
                parent:
                  type: string
                  description: Parent metadata ID (required for commentary)
            examples:
              root_text:
                summary: Root text creation
                value:
                  type: "root"
                  title:
                    en: "Sample Root Text"
                    bo: "རྩ་བའི་གཞུང་དཔེ།"
                  language: "bo"
                  contributions:
                    - person_id: "P12345678"
                      role: "author"
                  date: "2024-01-01"
                  bdrc: "W123456"
              translation_text:
                summary: Translation text creation
                value:
                  type: "translation"
                  title:
                    en: "English Translation"
                  language: "en"
                  contributions:
                    - person_bdrc_id: "P87654321"
                      role: "translator"
              ai_translation_text:
                summary: AI translation text creation
                value:
                  type: "translation"
                  title:
                    en: "AI English Translation"
                  language: "en"
                  contributions:
                    - ai_id: "gpt-4"
                      role: "translator"
                  parent: "T12345678"
      responses:
        "201":
          description: Text created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Text created successfully"
                  id:
                    type: string
                    examples:
                      - "T12345678"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "422":
          $ref: '#/components/responses/ValidationError'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/texts/{text_id}:
    get:
      summary: Retrieve text by ID
      description: Fetch a specific text by its ID
      tags:
        - Texts
      parameters:
        - name: text_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the text to retrieve
      responses:
        "200":
          description: Metadata retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  type:
                    type: string
                    enum: [root, commentary, translation]
                  title:
                    type: object
                    additionalProperties:
                      type: string
                  alt_titles:
                    type: array
                    items:
                      type: object
                      additionalProperties:
                        type: string
                  language:
                    type: string
                    enum: [en, bo, zh, sa]
                  contributions:
                    type: array
                    items:
                      type: object
                      properties:
                        person_id:
                          type: string
                        person_bdrc_id:
                          type: string
                        ai_id:
                          type: string
                        role:
                          type: string
                          enum: [author, translator, reviser, scholar]
                  date:
                    type: string
                  bdrc:
                    type: string
                  wiki:
                    type: string
                  parent:
                    type: string
              examples:
                success:
                  summary: Single text
                  value:
                    id: "T12345678"
                    type: "root"
                    title:
                      en: "Sample Expression"
                      bo: "དཔེ་མཚོན་ཚིག་སྒྲུབ།"
                    language: "bo"
                    contributions:
                      - person_id: "P12345678"
                        role: "author"
                    date: "2024-01-01"
                    bdrc: "W123456"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/persons:
    get:
      summary: Retrieve all persons
      description: Fetch all persons from the database with optional pagination
      tags:
        - Persons
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of results per page
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of results to skip
      responses:
        "200":
          description: Persons retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    name:
                      type: object
                      additionalProperties:
                        type: string
                    alt_names:
                      type: array
                      items:
                        type: object
                        additionalProperties:
                          type: string
                    bdrc:
                      type: string
                    wiki:
                      type: string
              examples:
                success:
                  summary: List of persons
                  value:
                    - id: "P12345678"
                      name:
                        en: "John Doe"
                        bo: "ཇོན་དོ།"
                      alt_names:
                        - en: "J. Doe"
                          bo: "ཇོན།"
                      bdrc: "P123456"
                      wiki: "Q123456"
        "500":
          $ref: '#/components/responses/ServerError'

    post:
      summary: Create a person
      description: Create a new person record
      tags:
        - Persons
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: object
                  additionalProperties:
                    type: string
                  description: Localized name
                alt_names:
                  type: array
                  items:
                    type: object
                    additionalProperties:
                      type: string
                  description: Alternative localized names
                bdrc:
                  type: string
                  description: BDRC identifier
                wiki:
                  type: string
                  description: Wikidata identifier
            examples:
              valid_person:
                summary: Valid person creation
                value:
                  name:
                    en: "John Doe"
                    bo: "ཇོན་དོ།"
                  alt_names:
                    - en: "J. Doe"
                      bo: "ཇོན།"
                  bdrc: "P123456"
                  wiki: "Q123456"
      responses:
        "201":
          description: Person created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Person created successfully"
                  _id:
                    type: string
                    examples:
                      - "P12345678"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "422":
          $ref: '#/components/responses/ValidationError'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/persons/{person_id}:
    get:
      summary: Retrieve person by ID
      description: Fetch a specific person by their ID
      tags:
        - Persons
      parameters:
        - name: person_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the person to retrieve
      responses:
        "200":
          description: Person retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: object
                    additionalProperties:
                      type: string
                  alt_names:
                    type: array
                    items:
                      type: object
                      additionalProperties:
                        type: string
                  bdrc:
                    type: string
                  wiki:
                    type: string
              examples:
                success:
                  summary: Single person
                  value:
                    id: "P12345678"
                    name:
                      en: "John Doe"
                      bo: "ཇོན་དོ།"
                    alt_names:
                      - en: "J. Doe"
                        bo: "ཇོན།"
                    bdrc: "P123456"
                    wiki: "Q123456"
        "400":
          $ref: '#/components/responses/InvalidRequest'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/segments/{segment_id}/related:
    get:
      summary: Find related texts for a segment
      description: Find all related texts and instances that are aligned to a specific segment
      tags:
        - Segments
      parameters:
        - name: segment_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the segment to find related texts for
      responses:
        "200":
          description: Related texts retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  targets:
                    type: array
                    description: Texts that this segment points to (outgoing alignments)
                    items:
                      type: object
                      properties:
                        instance:
                          type: object
                          description: Manifestation details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [diplomatic, critical, collated]
                            copyright:
                              type: string
                              enum: [public, copyrighted]
                            bdrc:
                              type: string
                            wiki:
                              type: string
                        text:
                          type: object
                          description: Expression (text) details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [root, commentary, translation]
                            title:
                              type: object
                              additionalProperties:
                                type: string
                            language:
                              type: string
                        segments:
                          type: array
                          description: List of aligned segments with their IDs and spans
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                                description: Segment ID
                              span:
                                type: object
                                properties:
                                  start:
                                    type: integer
                                    description: Start character position
                                  end:
                                    type: integer
                                    description: End character position
                  sources:
                    type: array
                    description: Texts whose segments point to this segment (incoming alignments)
                    items:
                      type: object
                      properties:
                        instance:
                          type: object
                          description: Manifestation details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [diplomatic, critical, collated]
                            copyright:
                              type: string
                              enum: [public, copyrighted]
                            bdrc:
                              type: string
                            wiki:
                              type: string
                        text:
                          type: object
                          description: Expression (text) details
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              enum: [root, commentary, translation]
                            title:
                              type: object
                              additionalProperties:
                                type: string
                            language:
                              type: string
                        segments:
                          type: array
                          description: List of aligned segments with their IDs and spans
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                                description: Segment ID
                              span:
                                type: object
                                properties:
                                  start:
                                    type: integer
                                    description: Start character position
                                  end:
                                    type: integer
                                    description: End character position
              examples:
                success:
                  summary: Related texts with segments
                  value:
                    targets:
                      - instance:
                          id: "M12345678"
                          type: "critical"
                          copyright: "public"
                        text:
                          id: "E12345678"
                          type: "translation"
                          title:
                            en: "Translation of the Text"
                          language: "en"
                        segments:
                          - id: "SEG001"
                            span:
                              start: 0
                              end: 100
                          - id: "SEG002"
                            span:
                              start: 100
                              end: 200
                    sources: []
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/ServerError'

  /v2/segments/{segment_id}/content:
    get:
      summary: Get segment text content
      description: Retrieve the base text content for a segment based on its character span
      tags:
        - Segments
      parameters:
        - name: segment_id
          in: path
          required: true
          schema:
            type: string
          description: The ID of the segment to retrieve text content for
      responses:
        "200":
          description: Segment content retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: string
                    description: The text content of the segment
              examples:
                success:
                  summary: Segment text content
                  value:
                    content: "This is the text content of the segment."
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/ServerError'

  /api/version:
      get:
        summary: Get API version and Git SHA
        description: Returns the current API version and the Git commit SHA of the deployed code.
        operationId: getVersion
        tags:
            - API
        responses:
            "200":
              description: Successfully retrieved version information
              content:
                application/json:
                  schema:
                    type: object
                    properties:
                      version:
                          type: string
                          examples: 
                            - "0.1.0"
                      git_sha:
                          type: string
                          examples:
                            - "b706d2b1a5d0176df374da25c970274b2e0f7770"
            "500":
              $ref: '#/components/responses/ServerError'

components:
  responses:
    InvalidRequest:
      description: There was an error with the request
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                description: Error message
                examples:
                  - "There was an error with the request"
            required:
              - error
      
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                description: Error message
                examples:
                  - "Resource was not found"
            required:
              - error
  
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              details:
                type: array
                items:
                  type: object
                  properties:
                    loc:
                      type: array
                      items:
                        type: string
                    msg:
                      type: string
                    type:
                      type: string
            required:
              - error
              - details
          examples:
            fieldMissing:
              value:
                error: "Validation error"
                details: [
                  {
                    "loc": ["body", "title"],
                    "msg": "field required", 
                    "type": "value_error.missing"
                  }
                ]

    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                description: Error message
                examples:
                  - "There was an error on the server"
            required:
              - error
